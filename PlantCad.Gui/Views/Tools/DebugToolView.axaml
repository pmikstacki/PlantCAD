<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:PlantCad.Gui.ViewModels.Tools"
             xmlns:h="using:PlantCad.Gui.Controls.CadViewport.Hatching"
             x:Class="PlantCad.Gui.Views.Tools.DebugToolView"
             x:DataType="vm:DebugToolViewModel">
  <DockPanel Margin="8">
    <TabControl>
      <TabItem Header="Hatch Diagnostics">
        <StackPanel Spacing="8" Margin="8">
          <ToggleSwitch IsChecked="{Binding HatchesEnabled, Mode=TwoWay}">
            <TextBlock Text="Enable hatch debug overlay (bounds + anchor)"/>
          </ToggleSwitch>
          
          <StackPanel Orientation="Vertical" Spacing="4">
             <TextBlock Text="Debug specific Hatch ID (logs to console):" FontSize="12"/>
             <TextBox Text="{Binding DebugHatchId, Mode=TwoWay}" Watermark="e.g. 894110"/>
          </StackPanel>

          <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
            <TextBlock Text="Bounds Inflation (px)" Width="140"/>
            <Slider Minimum="-100" Maximum="100" TickFrequency="1" IsSnapToTickEnabled="False"
                    Value="{Binding BoundsInflation, Mode=TwoWay}" Width="180"/>
            <TextBlock Text="{Binding BoundsInflation}" Width="48"/>
          </StackPanel>

          <ToggleSwitch IsChecked="{Binding UseFixedSquareTile, Mode=TwoWay}">
             <TextBlock Text="Use Fixed Square Tile (Debug)"/>
          </ToggleSwitch>

          <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center" IsVisible="{Binding UseFixedSquareTile}">
             <TextBlock Text="Fixed Tile Size" Width="140"/>
             <Slider Minimum="1.0" Maximum="1024.0" TickFrequency="1" IsSnapToTickEnabled="False"
                     Value="{Binding FixedTileSize, Mode=TwoWay}" Width="180"/>
             <TextBlock Text="{Binding FixedTileSize, StringFormat=F0}" Width="48"/>
          </StackPanel>
          
          <TextBlock Text="Debug Output:" FontSize="12" Margin="0,8,0,0"/>
          <Border BorderBrush="Gray" BorderThickness="1" CornerRadius="4" Height="120">
             <ScrollViewer>
                <TextBox Text="{Binding DebugOutput}" FontFamily="Consolas,Monospace" FontSize="11" TextWrapping="Wrap" Margin="4"
                         Focusable="False" IsReadOnly="True" />
             </ScrollViewer>
          </Border>
        </StackPanel>
      </TabItem>
      <TabItem Header="Hatch Cache">
        <Grid RowDefinitions="*,Auto" Margin="8">
          <DockPanel Grid.Row="0">
             <Grid DockPanel.Dock="Top" ColumnDefinitions="*,Auto,Auto,*,Auto,*,Auto,Auto" Margin="0,0,0,4">
               <TextBlock Text="Key" FontWeight="Bold"/>
               <TextBlock Grid.Column="1" Text="AbsSpacing" FontWeight="Bold" Margin="8,0,0,0"/>
               <TextBlock Grid.Column="2" Text="DashPeriod" FontWeight="Bold" Margin="8,0,0,0"/>
               <TextBlock Grid.Column="3" Text="DashKey" FontWeight="Bold" Margin="8,0,0,0"/>
               <TextBlock Grid.Column="4" Text="Color" FontWeight="Bold" Margin="8,0,0,0"/>
               <TextBlock Grid.Column="5" Text="TileRect" FontWeight="Bold" Margin="8,0,0,0"/>
               <TextBlock Grid.Column="6" Text="Hits" FontWeight="Bold" Margin="8,0,0,0"/>
               <TextBlock Grid.Column="7" Text="Created" FontWeight="Bold" Margin="8,0,0,0"/>
             </Grid>
             <ListBox ItemsSource="{Binding CacheEntries}" SelectedItem="{Binding SelectedCacheEntry}" Background="Transparent">
               <ListBox.ItemTemplate>
                 <DataTemplate x:DataType="h:HatchCacheEntry">
                   <Grid ColumnDefinitions="*,Auto,Auto,*,Auto,*,Auto,Auto" Margin="0,2">
                     <TextBlock Text="{Binding Key}"/>
                     <TextBlock Grid.Column="1" Text="{Binding AbsSpacing, StringFormat=F3}" Margin="8,0,0,0"/>
                     <TextBlock Grid.Column="2" Text="{Binding DashPeriod, StringFormat=F3}" Margin="8,0,0,0"/>
                     <TextBlock Grid.Column="3" Text="{Binding DashKey}" Margin="8,0,0,0"/>
                     <TextBlock Grid.Column="4" Text="{Binding Color}" Margin="8,0,0,0"/>
                     <TextBlock Grid.Column="5" Text="{Binding TileRect}" Margin="8,0,0,0"/>
                     <TextBlock Grid.Column="6" Text="{Binding Hits}" Margin="8,0,0,0"/>
                     <TextBlock Grid.Column="7" Text="{Binding CreatedAt, StringFormat=G}" Margin="8,0,0,0"/>
                   </Grid>
                 </DataTemplate>
               </ListBox.ItemTemplate>
             </ListBox>
          </DockPanel>
          
          <Border Grid.Row="1" Height="200" Margin="0,8,0,0" BorderBrush="Gray" BorderThickness="1" Background="#F0F0F0">
             <Image Source="{Binding SelectedPreviewImage}" Stretch="None" HorizontalAlignment="Center" VerticalAlignment="Center"/>
          </Border>
        </Grid>
      </TabItem>
    </TabControl>
  </DockPanel>
</UserControl>
